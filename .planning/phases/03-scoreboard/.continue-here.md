---
phase: 03-scoreboard
task: 7
total_tasks: 7
status: in_progress
last_updated: 2026-02-25T23:55:40.690Z
---

<current_state>
Phase 03 plan 07 (human verification checkpoint) is IN PROGRESS. The app is running on
the iOS 26 simulator (iPhone 17) with live NCAA data. Three major fixes were committed
this session. User has seen the app but flagged remaining UI issues that still need
attention before sign-off.
</current_state>

<completed_work>

- Plans 03-01 through 03-06: ALL DONE, committed
- NCAA GraphQL scraper rewrite: DONE, committed (5418cb0)
- ScraperScheduler fix: scrapes ALL D1 conferences, fixed actor lifetime bug (stored in app.storage), seeded all conferences — DONE, committed (5418cb0)
- TBD display for midnight-ET placeholder times: DONE, committed (64ddfd7)
- Pull-to-refresh fix: replaced GeometryReader+PreferenceKey with onScrollGeometryChange, moved PullToRefreshView to ZStack overlay — DONE, committed (da462b2)
- Removed .tabBarMinimizeBehavior(.onScrollDown) that broke tab bar safe area — DONE, committed (da462b2)
- Backend verified: 2 games at /api/v1/games/date/2026-02-25 with correct conferences (CAA, MAAC, A10, IVY) and NCAA CDN logo URLs
</completed_work>

<remaining_work>

- User flagged remaining iOS 26 UI issues in the last screenshot review:
  1. Nav bar / large title has excessive blank space above it on iOS 26 — the NavigationStack large title area takes ~35% of the screen before content starts. May need .navigationBarTitleDisplayMode(.inline) or iOS 26-specific layout adjustment.
  2. Pull-to-refresh: code was fixed (onScrollGeometryChange) but user hasn't confirmed it works yet after the rebuild — needs re-test.
  3. Date strip shows only 1 date ("Wed Feb25") because only today has games in DB. This is correct behavior but looks sparse. Could pre-seed some historical dates or show a range even without games.
  4. Game cards show placeholder icon (sportscourt SF Symbol) instead of team logos — Kingfisher is loading NCAA SVG URLs but they may not render in KFImage (SVGs need SVGKit or conversion). Need to verify if logos actually display.
  5. Card bottom was cut off by tab bar — .tabBarMinimizeBehavior was removed, but user hasn't confirmed the fix yet.
- Once UI issues are resolved: user approves → write 03-07-SUMMARY.md → Phase 3 complete
- Then /gsd:verify-work 3 and advance to Phase 4
</remaining_work>

<decisions_made>

- NCAA GraphQL API (sdataprod.ncaa.com) is the primary data source — NOT ESPN
- seasonYear = 2025 for 2025-26 season (NCAA uses academic year start)
- All D1 conferences scraped per cycle (no Phase 1 filter)
- onScrollGeometryChange replaces GeometryReader+PreferenceKey for pull-to-refresh detection
- Leading-edge trigger only: refresh fires when pull crosses threshold going up (oldPull <= threshold, newPull > threshold)
- PullToRefreshView rendered as ZStack overlay, not inside ScrollView content
- .tabBarMinimizeBehavior(.onScrollDown) removed — caused safe area issues on iOS 26
- TBD shown for games at midnight ET (NCAA placeholder for unannounced times)
- SeedAllConferences migration added for CAA, MAAC, A10, AE, NEC, SOCON, ASUN, BIGSOUTH, OVC
- App.scraperScheduler stored via Application.storage (Vapor StorageKey pattern) to prevent actor deallocation
</decisions_made>

<blockers>

- NCAA SVG logos may not render in Kingfisher/KFImage — need to check if SVGKit integration is needed or if PNG fallback URLs exist
- iOS 26 NavigationStack large title takes excessive vertical space — may be intended iOS 26 design or may need layout adjustment
- Only 2 games on Feb 25 (early season) — sparse data makes the scoreboard look empty; will improve as season progresses
</blockers>

<context>
The backend is solid — scraper works, API returns correct data, all conferences mapped.
The remaining work is purely iOS 26 UI polish. The user hasn't re-tested after the last
round of fixes (pull-to-refresh, tab bar safe area). The next step is to relaunch the
app on the simulator and walk through the 03-07 verification checklist. Any UI gaps
discovered during verification should be fixed as small commits before writing the
03-07-SUMMARY.md.

The server needs to be running locally for the app to show data:
  lsof -ti :8080 | xargs kill -9 2>/dev/null; sleep 1
  .build/debug/App serve --hostname 0.0.0.0 --port 8080 &

The app bundle ID is com.bardown.app (not com.darren.BarDown).
</context>

<next_action>
Start with: Relaunch the app on iOS 26 simulator and have user verify:
1. Is the card fully visible (not cut off by tab bar)?
2. Does pull-to-refresh show the lacrosse ball?
3. Are team logos rendering or showing placeholders?
4. Is the nav bar spacing acceptable?

Then fix any remaining issues and write 03-07-SUMMARY.md to close Phase 3.

Commands to rebuild and relaunch:
```bash
# Make sure server is running
lsof -ti :8080 | xargs kill -9 2>/dev/null; sleep 1
.build/debug/App serve --hostname 0.0.0.0 --port 8080 &

# Build and launch iOS app
xcodebuild build -project BarDown-iOS/BarDown.xcodeproj -scheme BarDown -destination 'platform=iOS Simulator,id=C87A0E81-7647-4D01-9B16-82737A18DF0A' 2>&1 | tail -3
xcrun simctl terminate C87A0E81-7647-4D01-9B16-82737A18DF0A com.bardown.app 2>/dev/null
xcrun simctl install C87A0E81-7647-4D01-9B16-82737A18DF0A $(find ~/Library/Developer/Xcode/DerivedData/BarDown-*/Build/Products/Debug-iphonesimulator -name "BarDown.app" -maxdepth 1 | head -1)
xcrun simctl launch C87A0E81-7647-4D01-9B16-82737A18DF0A com.bardown.app
```
</next_action>
