---
phase: 03-scoreboard
plan: 05
type: execute
wave: 3
depends_on: [03-03]
files_modified:
  - BarDown-iOS/BarDown/Features/Scoreboard/GameCardView.swift
  - BarDown-iOS/BarDown/Features/Scoreboard/TeamRowView.swift
  - BarDown-iOS/BarDown/Features/Scoreboard/ScoreCenterView.swift
  - BarDown-iOS/BarDown/Features/Scoreboard/LiveIndicator.swift
autonomous: true
requirements: [SCOR-02, SCOR-03, TEAM-05]

must_haves:
  truths:
    - "GameCardView renders away team on top, home team on bottom in a full-width stacked layout"
    - "TeamRowView shows Kingfisher logo (52pt), abbreviation, record, and optional ranking badge"
    - "ScoreCenterView shows score for live/final games, start time + venue for upcoming games"
    - "Live cards display a blinking red dot and subtle accent glow"
    - "Final cards show 'FINAL' label and winning team row is bold"
    - "Card backgrounds are opaque (no .glassEffect) — DESG-02 compliant"
    - "GlassAuditTests still pass after adding card code"
  artifacts:
    - path: "BarDown-iOS/BarDown/Features/Scoreboard/GameCardView.swift"
      provides: "Full game card composed from TeamRowView + ScoreCenterView"
      exports: ["GameCardView"]
      min_lines: 50
    - path: "BarDown-iOS/BarDown/Features/Scoreboard/TeamRowView.swift"
      provides: "Single team row: KFImage logo, abbreviation, record, ranking pill"
      exports: ["TeamRowView"]
    - path: "BarDown-iOS/BarDown/Features/Scoreboard/ScoreCenterView.swift"
      provides: "Center score block: score or start time, period/clock, game status label"
      exports: ["ScoreCenterView"]
    - path: "BarDown-iOS/BarDown/Features/Scoreboard/LiveIndicator.swift"
      provides: "Blinking red circle animation for live games"
      exports: ["LiveIndicator"]
  key_links:
    - from: "BarDown-iOS/BarDown/Features/Scoreboard/GameCardView.swift"
      to: "BarDown-iOS/BarDown/Models/GameModel.swift"
      via: "GameModel parameter — no tap action (view-only per CONTEXT.md)"
      pattern: "let game: GameModel"
    - from: "BarDown-iOS/BarDown/Features/Scoreboard/TeamRowView.swift"
      to: "Kingfisher KFImage"
      via: "import KingfisherSwiftUI — logo URL or local asset fallback"
      pattern: "KFImage"
---

<objective>
Build the game card component hierarchy: the visual atoms (TeamRowView, ScoreCenterView, LiveIndicator) and the composed GameCardView that renders one game.

Purpose: These are pure display components — no networking, no state management. They take a `GameModel` and render it. Can be developed in parallel with Plan 03-04 (ViewModel layer) since both only need `GameModel` from Plan 03-03.

Output: Four Swift files. GlassAuditTests remain passing (no glass on content). Kingfisher integrated via project.yml SPM dependency.
</objective>

<execution_context>
@/Users/darrenbrelesky/.claude/get-shit-done/workflows/execute-plan.md
@/Users/darrenbrelesky/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-scoreboard/03-RESEARCH.md
@.planning/phases/03-scoreboard/03-03-SUMMARY.md

@BarDown-iOS/BarDown/Models/GameModel.swift
@BarDown-iOS/BarDown/Models/TeamModel.swift
@BarDown-iOS/BarDownTests/GlassAuditTests.swift
@BarDown-iOS/project.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Kingfisher SPM dependency and create TeamRowView + LiveIndicator</name>
  <files>
    BarDown-iOS/project.yml,
    BarDown-iOS/BarDown/Features/Scoreboard/TeamRowView.swift,
    BarDown-iOS/BarDown/Features/Scoreboard/LiveIndicator.swift
  </files>
  <action>
**Step 1: Add Kingfisher to project.yml**

In `BarDown-iOS/project.yml`, add Kingfisher to the `packages` section:
```yaml
packages:
  GlassKit:
    path: Packages/GlassKit
  Kingfisher:
    url: https://github.com/onevcat/Kingfisher.git
    minorVersion: "8.0.0"
```

And add it to the `BarDown` target dependencies:
```yaml
dependencies:
  - package: GlassKit
  - package: Kingfisher
    product: KingfisherSwiftUI
```

After editing project.yml, regenerate the Xcode project:
```bash
cd BarDown-iOS && xcodegen generate
```

**Step 2: Create LiveIndicator.swift**
```swift
import SwiftUI

struct LiveIndicator: View {
    @State private var isBlinking = false

    var body: some View {
        Circle()
            .fill(Color.red)
            .frame(width: 8, height: 8)
            .opacity(isBlinking ? 0.3 : 1.0)
            .animation(
                .easeInOut(duration: 0.8).repeatForever(autoreverses: true),
                value: isBlinking
            )
            .onAppear { isBlinking = true }
    }
}
```

**Step 3: Create TeamRowView.swift**

TeamRowView renders one team in the card (either the away row or home row):

```swift
import SwiftUI
import KingfisherSwiftUI

struct TeamRowView: View {
    let team: TeamModel
    let score: Int
    let isWinner: Bool   // for final games — bold treatment
    let isLive: Bool

    var body: some View {
        HStack(spacing: 12) {
            // Logo (~52pt as per CONTEXT.md 48-56pt range)
            TeamLogoView(logoAssetName: team.logoAssetName)

            // Abbreviation + record
            VStack(alignment: .leading, spacing: 2) {
                HStack(spacing: 6) {
                    Text(team.abbreviation)
                        .font(.headline)
                        .fontWeight(isWinner ? .bold : .regular)
                        .foregroundStyle(isWinner ? .primary : .secondary)

                    // Ranking badge (e.g., "#3")
                    if let ranking = team.ranking {
                        Text("#\(ranking)")
                            .font(.caption2)
                            .fontWeight(.semibold)
                            .foregroundStyle(.white)
                            .padding(.horizontal, 5)
                            .padding(.vertical, 2)
                            .background(Capsule().fill(Color.accentColor))
                    }
                }

                if let record = team.record {
                    Text(record)
                        .font(.caption)
                        .foregroundStyle(.tertiary)
                }
            }

            Spacer()

            // Score (only for live/final — upcoming handled by ScoreCenterView)
            Text("\(score)")
                .font(.title2)
                .fontWeight(isWinner ? .bold : .regular)
                .monospacedDigit()
                .foregroundStyle(isWinner ? .primary : .secondary)
        }
        .padding(.horizontal, 16)
        .padding(.vertical, 10)
    }
}

// MARK: - Logo View

struct TeamLogoView: View {
    let logoAssetName: String?

    var body: some View {
        Group {
            if let name = logoAssetName, let url = URL(string: name) {
                // URL-based logo — use Kingfisher for caching
                KFImage(url)
                    .resizable()
                    .placeholder {
                        Image(systemName: "sportscourt")
                            .resizable()
                            .foregroundStyle(.tertiary)
                    }
                    .scaledToFit()
            } else if let name = logoAssetName, !name.isEmpty {
                // Local asset name
                Image(name)
                    .resizable()
                    .scaledToFit()
            } else {
                // No logo available
                Image(systemName: "sportscourt")
                    .resizable()
                    .foregroundStyle(.tertiary)
                    .scaledToFit()
            }
        }
        .frame(width: 52, height: 52)
    }
}
```

**DESG-02 compliance:** No `.glassEffect()` calls anywhere in these files. Backgrounds use system materials or explicit colors only.
  </action>
  <verify>
    <automated>xcodebuild build -project BarDown-iOS/BarDown.xcodeproj -scheme BarDown -destination 'platform=iOS Simulator,name=iPhone 17 Pro' 2>&1 | tail -10</automated>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>
    `xcodebuild build` exits 0. Kingfisher resolves and links. `KFImage` used in `TeamLogoView`. `LiveIndicator` uses `repeatForever` animation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ScoreCenterView and GameCardView</name>
  <files>
    BarDown-iOS/BarDown/Features/Scoreboard/ScoreCenterView.swift,
    BarDown-iOS/BarDown/Features/Scoreboard/GameCardView.swift
  </files>
  <action>
**ScoreCenterView.swift** — center block between the two team rows:

```swift
import SwiftUI

struct ScoreCenterView: View {
    let game: GameModel

    private let timeFormatter: DateFormatter = {
        let f = DateFormatter()
        f.timeStyle = .short
        f.timeZone = TimeZone(identifier: "America/New_York")!
        return f
    }()

    var body: some View {
        VStack(spacing: 2) {
            switch game.gameStatus {
            case .live:
                // Score display for live game
                HStack(spacing: 4) {
                    LiveIndicator()
                    Text("LIVE")
                        .font(.caption2)
                        .fontWeight(.bold)
                        .foregroundStyle(.red)
                }
                if let period = game.period, let clock = game.clock {
                    Text("\(period)  \(clock)")
                        .font(.caption2)
                        .foregroundStyle(.secondary)
                        .monospacedDigit()
                }

            case .final_:
                Text("FINAL")
                    .font(.caption2)
                    .fontWeight(.semibold)
                    .foregroundStyle(.secondary)

            case .scheduled:
                // Show start time + venue placeholder
                Text(timeFormatter.string(from: game.startTime))
                    .font(.callout)
                    .fontWeight(.medium)
                    .foregroundStyle(.primary)
            }
        }
        .frame(maxWidth: .infinity)
        .padding(.vertical, 4)
    }
}
```

**GameCardView.swift** — composed full card:

```swift
import SwiftUI

struct GameCardView: View {
    let game: GameModel
    // NOTE: No onTapGesture — view-only in Phase 3 (tap opens game detail in Phase 5)

    private var awayIsWinner: Bool {
        game.isFinal && game.awayScore > game.homeScore
    }

    private var homeIsWinner: Bool {
        game.isFinal && game.homeScore > game.awayScore
    }

    var body: some View {
        VStack(spacing: 0) {
            // Away team row
            TeamRowView(
                team: game.awayTeam,
                score: game.awayScore,
                isWinner: awayIsWinner,
                isLive: game.isLive
            )

            // Center score / time / status block
            Divider()
                .padding(.leading, 80)  // align with team name, not logo
            ScoreCenterView(game: game)
            Divider()
                .padding(.leading, 80)

            // Home team row
            TeamRowView(
                team: game.homeTeam,
                score: game.homeScore,
                isWinner: homeIsWinner,
                isLive: game.isLive
            )
        }
        .background(
            RoundedRectangle(cornerRadius: 16)
                .fill(Color(.secondarySystemGroupedBackground))
                .shadow(color: game.isLive ? .red.opacity(0.12) : .black.opacity(0.06),
                        radius: game.isLive ? 8 : 4,
                        y: 2)
        )
        // Live game: subtle red accent border
        .overlay {
            if game.isLive {
                RoundedRectangle(cornerRadius: 16)
                    .stroke(Color.red.opacity(0.3), lineWidth: 1)
            }
        }
        // DESG-02: DO NOT add .glassEffect() here — game cards must be opaque
    }
}

#Preview {
    VStack(spacing: 12) {
        GameCardView(game: .placeholder)
    }
    .padding()
    .background(Color(.systemGroupedBackground))
}
```

**Design decisions made (Claude's Discretion from CONTEXT.md):**
- Ranking badge: accent-colored capsule pill positioned next to abbreviation
- Card shadow: subtle black shadow for all cards; live cards get a faint red glow shadow
- Live accent: `Color.red.opacity(0.3)` border stroke on card outline (not a heavy glow)
- Card background: `Color(.secondarySystemGroupedBackground)` — adapts to dark/light mode, fully opaque per DESG-02
- Divider inset to 80pt aligns with where team name starts (after 52pt logo + 16pt gap)
- No animation on card itself — cards are static display; only LiveIndicator animates
  </action>
  <verify>
    <automated>xcodebuild test -project BarDown-iOS/BarDown.xcodeproj -scheme BarDown -destination 'platform=iOS Simulator,name=iPhone 17 Pro' -only-testing:BarDownTests/GlassAuditTests 2>&1 | tail -10</automated>
    <manual>GlassAuditTests must pass — no .glassEffect() leak in card code</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>
    `xcodebuild build` exits 0. `GameCardView` renders away/home stacked layout with center ScoreCenterView. `GlassAuditTests` pass (no glass leaks). Cards use opaque backgrounds.
  </done>
</task>

</tasks>

<verification>
- `xcodebuild build` exits 0 — Kingfisher links, all card types compile
- `GlassAuditTests` pass — no `.glassEffect()` in any card file
- `TeamLogoView` uses `KFImage` for URL logos, local `Image()` fallback for asset names
- `GameCardView` has a `// DESG-02: DO NOT add .glassEffect()` comment as a guard
- `LiveIndicator` uses SwiftUI `repeatForever` animation (not Timer-based)
- Card has no `onTapGesture` (Phase 3 is view-only per CONTEXT.md locked decision)
- `ScoreCenterView` shows period+clock for live, "FINAL" for final, start time for scheduled
</verification>

<success_criteria>
Full game card component hierarchy renders correctly for all three game states (live, final, scheduled). Kingfisher integrated and used for URL-based logos. DESG-02 compliant — all backgrounds opaque. GlassAuditTests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/03-scoreboard/03-05-SUMMARY.md`
</output>
